<!doctype html>
<html>
<head>
  <title>Job Log &raquo; SUZHOU</title>
  <link rel="stylesheet" type="text/css" href="resource://CAEJobLog-at-tenneco-dot-com/data/css/jquery.gridster.css">
  <link rel="stylesheet" type="text/css" href="resource://CAEJobLog-at-tenneco-dot-com/data/css/user.css">
  <link rel="stylesheet" type="text/css" href="resource://CAEJobLog-at-tenneco-dot-com/data/css/jquery-ui.css">
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <link width="16px" height="16px" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8%2F9hAAAAB3RJTUUH3wQdDyMlhr7JwwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAARnQU1BAACxjwv8YQUAAAOQSURBVHjaZVNdTFtlGP7OX885LaWs7U5%2Fdgq0HZDKxMCYjhsCN3PAwrY0wwu82S50i2ReOEOCi7rb3eluvDFOzUoybHQqSGBLCVsK28hGWSh2pWWt8tO%2F09L2tKc95%2FTYglWib%2FJ%2Byfv35H3ePB8E%2FmM8z8vcC8sDv%2FzsuyyIh6EEQ1APlyXrQK9i7bOx1iGKkr862A8dDFZWfOdcrueDs%2FczPSrtUemOH7d0HCXjtAZLmlRwxKpDwvZ%2B460Gk3LxfwBeb6BrbOy7r3wvqQacOoaeHtB5sDoCarXUPm8x4Q9pSrY4Ppe%2BtvI70%2F6R%2FfB1W1OdqzKHVp5EYld79%2B7MGYKg8Nc62uKCQS02v2F4PNxbO4ZjEFfpYfKS5deS2o5riPR7X29ObEfYboNO4YUTiRTtdN6%2F%2FuRJ8NTkI1WzM4Zbea0KubSpvDoVAp9XNwxx4M0ZPdDztJxEaEN%2B0Zu1721w8%2Bad7%2F3%2B6JF8Xka%2BddwYiRoJuahWI0AHIeezYPSnaBp0YsG5e4XsBaCuAdMAmAaNNeueP3PtXn%2ByH2WYHJbPC4TbDR%2FpsxNrqJZkX0Cyep0SlDp2lqWnHu%2B1dSH1QUr9qnj%2BxNkNRQnw5HYIKJMznb9NSt0oSWIphuFaG821bAONBxtpHNB1ICdTgILke2n85tOPjZlMpmb48pVg4MRZLV4CELLDCM4bnyj5IoeiBsOhSGPjbiSTheS7KU4jP8RnHguCdVOFEGZAwOVhUPHs9tZGCw9kEzlAv10UNtKZbK1QzAO4u7vtHseJ2NRk2JSIpTQeb7qtHWb9TAzAgPtXI6Iolq6woRuaSJZXpHfFsgL2JIDabOaVri7LUjic0cJSRHrgVuqHDNH0BQT3B5OgqQpQksTeeeft4yMA5f7YipkRqAQLVSE5HFO35udX2xPxon5ygbbmzM3gUp%2Fag%2BUXdY4vRvQVCgRBAAzD9sFKJcCyLPhHSCdPvj7h8QTNKhWZekcZzwNEJRXDCGagYqvlsr7Sc%2BrcRRFTdXB8tiBpiYD%2F29tf2sq0iD0Ai8U0HwiE4fHx2avT0%2BtajyegP913bAspCFSVQjIhRyiofmPojPaHd4dHfiynHpV9H6BiVmv9XKFQfNrTszrocDz4MJNl8CQTtVXrTSY2NDpqe7%2Blpd5dDtuqeRQcMByXVYiN7%2BzEF549W%2Bt3uWYvLi0pO%2Fe%2FOev7e7hyC4gkSUiSJPAX8KiTGSEMXhoAAAAASUVORK5CYII%3D" rel="shortcut icon">
<script>
function saveNotetoFile(theid) {
    var note = document.getElementById(theid).value;
    var ewsnum = "EWS" + theid.replace(/\D/g,'');
    var datapackage = new Array(ewsnum, note);
    sendAsyncMessage("SaveNote", datapackage);
}

function clearAllSS() {
    var array = new Array("suzhou", "");
    sendAsyncMessage("deleteNotes", array);
    console.log("Stored EWS notes cleared.");
    location.reload();
}

function clearSizes(user) {
    //Sends empty string to 'clear' sizes
    var sizearray = new Array("suzhou", "");
    sendAsyncMessage("SaveSizes", sizearray);
    location.reload();
}
</script>
</head>
<body>
    <h1>Suzhou, China</h1>
    <p>List of currently assigned jobs.</p>

    <div class="gridster">
        <ul></ul>
    </div>
    <div class="container"><button id="reload" title="Refresh widget data" class="rel_but">Update Page</button></div>
    <div class="container"><button id="delete" title="Delete ALL user widget notes and sizes" class="del_but">Delete Notes</button></div>
    <div class="container"><button id="clearSize" title="Reset widget dimensions and locations" class="cs_but">Reset Sizes</button></div>
    <script type="text/javascript" src="resource://CAEJobLog-at-tenneco-dot-com/data/js/jquery-3.0.0.pre.js"></script>
    <script type="text/javascript" src="resource://CAEJobLog-at-tenneco-dot-com/data/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="resource://CAEJobLog-at-tenneco-dot-com/data/js/jquery.gridster.js" charset="utf-8"></script>

<script>
    $( ".rel_but" ).button({ icons: {primary:'ui-icon-arrowrefresh-1-w'} });
    $( ".del_but" ).button({ icons: {primary:'ui-icon-trash'},text:false });
    $( ".cs_but" ).button({ icons: {primary:'ui-icon-transferthick-e-w'} });
</script>
    <script type="text/javascript" id="code">
    var gridster;

    $(function(){

      gridster = $(".gridster > ul").gridster({
          widget_margins: [10, 10],
          widget_base_dimensions: [100, 55],
          helper: 'clone',
          resize: {
            enabled: true,
            stop: function(e, ui, $widget) {
                var s = gridster.serialize();
                var s2 = JSON.stringify(s);
                //Save sizes
                var sizearray = new Array("suzhou", s2);
                sendAsyncMessage("SaveSizes", sizearray);
            }
          }
      }).data('gridster');
      
        $('.gridster').on('click', function() {
            var s = gridster.serialize();
            var s2 = JSON.stringify(s);
            try {
                //Save sizes
                var sizearray = new Array("paul", s2);
                sendAsyncMessage("SaveSizes", sizearray);
            } catch (e) {
                console.error(e + " Error");
            }
        });
    });
    </script>
    <script>
    function init() {
        addMessageListener("SetNote", function(msg) {
            var notearray = msg.data;
            var ews = notearray[1];
            var message = notearray[0];
            var note = document.getElementById(ews + '_note');
            note.value = message;
        }); 

        var thewidgets = clonedContentScriptObject.thewidgets;
        var serArray = clonedContentScriptObject.theserial;
        //Check if assigned job qty has changed 
        //First check if it's ever been set
        if (serArray !== "") {
            var serArray = JSON.parse(serArray);
            //Then check if the length has changed
            if (thewidgets.length != serArray.length) {
                //Qty changed so clear widget location data
                clearSizes("_h");
            }
            //Qty not changed
            else {
                for (var h=0; h < thewidgets.length; h++) {
                    if (serArray) {
                        var c = serArray[h].col;
                        var r = serArray[h].row;
                        var x = serArray[h].size_x;
                        var y = serArray[h].size_y;
                        gridster.add_widget('<li class="new"><a href=http://pafoap01:8888/pls/prod/ece_ewo_web.ece_ewo_page?in_ewr_no=' + thewidgets[h] + '>' + thewidgets[h] + '</a><BR><textarea id="' + thewidgets[h] + '_note" placeholder="Notes:" autocomplete="off" spellcheck="true" rows="6" cols="23" onload="getNote(this.id)" oninput="saveNotetoFile(this.id);"></textarea></li>', x, y, c, r);
                        //Request note and add
                        sendAsyncMessage("GetNote", thewidgets[h]);
                    }
                    else {
                        gridster.add_widget('<li class="new"><a href=http://pafoap01:8888/pls/prod/ece_ewo_web.ece_ewo_page?in_ewr_no=' + thewidgets[h] + '>' + thewidgets[h] + '</a><BR><textarea id="' + thewidgets[h] + '_note" placeholder="Notes:" autocomplete="off" spellcheck="true" rows="6" cols="23" onload="getNote(this.id)" oninput="saveNotetoFile(this.id);"></textarea></li>', 2, 2);
                        //Request note and add
                        sendAsyncMessage("GetNote", thewidgets[h]);
                    }
                }
            }
        }
        //Not set so just add widgets
        else {
            for (var h=0; h < thewidgets.length; h++) {
                gridster.add_widget('<li class="new"><a href=http://pafoap01:8888/pls/prod/ece_ewo_web.ece_ewo_page?in_ewr_no=' + thewidgets[h] + '>' + thewidgets[h] + '</a><BR><textarea id="' + thewidgets[h] + '_note" placeholder="Notes:" autocomplete="off" spellcheck="true" rows="6" cols="23" onload="getNote(this.id)" oninput="saveNotetoFile(this.id);"></textarea></li>', 2, 2);
                //Request note and add
                sendAsyncMessage("GetNote", thewidgets[h]);
            } 
        }
        //Reload when button pressed
        var works = document.getElementById("reload");
        works.addEventListener("click", function() {
            gridster.remove_all_widgets();
            init();
            location.reload();
      }, false);
        //getNoteStart();
    }

        //Delete when button pressed
        var clearSS = document.getElementById("delete");
        clearSS.addEventListener("click", function() {
            clearAllSS();
        }, false);
        
        //Reset sizes when button pressed
        var clearSize = document.getElementById("clearSize");
        clearSize.addEventListener("click", function() {
            clearSizes("_h");
        }, false);
    
    $(window).load(function() {
        window.setTimeout(init, 100);
    });
    </script>
</body>
</html>