<!doctype html>
<html>
<head>
  <title>Job Log &raquo; PAUL</title>
  <link rel="stylesheet" type="text/css" href="resource://CAEJobLog-at-tenneco-dot-com/data/css/jquery.gridster.css">
  <link rel="stylesheet" type="text/css" href="resource://CAEJobLog-at-tenneco-dot-com/data/css/user.css">
  <link rel="stylesheet" type="text/css" href="resource://CAEJobLog-at-tenneco-dot-com/data/css/jquery-ui.css">
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <link width="16px" height="16px" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8%2F9hAAAAB3RJTUUH3wQdDyMs%2F2JxZwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAARnQU1BAACxjwv8YQUAAAOZSURBVHjahVJraFt1FP%2FfV%2B69ed00zZImzTtrte1szCZmFSydinarBCXMgX7RIiIONucEMRQN%2FSIWxA9%2B8AH7MtkKHcV1c7Fm7VpWre0qdMlotpomW6NZm9dtXjf3Jrm31zU6KPODB86BA79zzu%2FH%2BUHgkajX65L5324OXL60%2Bi4v7IFyNKGduyk6Bg7Jbn%2Fq63pNq5Xe242Hdjfh8OorMzPLnqtTpT5Ks1c8F8Xt%2B%2FeSWWMztmWi4JRDhyS8RwxfWUyKhf8siERiPT7f2W9W%2F9BacO0%2BtH9AF8JUBNRlVy4%2FZsLnjFrJwuhs8cPwHdp12rtnqKNNNbMzh%2B6UXK6gGRsLvkwQWrxzf3eW16uFdqd%2B8Y1DSh%2BOQdwOhmZF%2B4%2Fbai%2FeTBTfOZO8sJFievU6WQTO5fLG8fGpoRs34i9e%2BYVqH8%2FgjrqGQgaTihOBdeB%2FyHCdA08HW0BL3SglEaOeXYiUvQ0GIyPnvo9G060sKyHdBwyptIGQCmo1AnQQ8moZfHQxXQRPYfHZiWr5KFDLwSQAJo9Bvhb6q%2BKKRLeOoDRdwViWJ%2Bbn4dbDXuI2qiGZW5DErFOAbQrlhJ%2BDk6fXqpnjNXgZGRbRarkq1jMMIZepNLWpRfMgSpJYnqa5LqtNyViMeNxqxIFRBSoSGajWtjnk4shnneW7a%2FJdz8IfpNxgsnk8x04xqF7flLJaC6lSGZIW8lyztKleWuR5R5JCCJpCYFAXACiVAIIg%2FPNvHxdosglP%2F%2FQDvxoJk99%2B8T4C9%2FZ2T3CcgAWuJEy5TL45FCl2u2AmSmcADPIAqFm2snNWEATW%2FXinL9zvr7tfenMLx3FQLBYkcEeHLdzTY%2F%2Fd5cKKsJgSp%2BdLLdz9NHmUYaLggefEciHf4E1gUoT5s%2BPz5KVrdHxJVa1WG3pgtVp1z2zWpt1uw61tfgOV5u%2BCsWv5dkU6WRms5MIwLCANBryI%2FHp9afDMl0MvzAXHMQiCgNPpzDaMdPDgExdCobiNosj8MUWWBQgl1hII9uwz4tgEwE7%2BKwHcWY1BGIpBTueBgsXSGm5raws0FtjtpuuxWAIeHb16YnJyTRMKxVr6D%2B%2B7H6TVr9c4XPaP6QngfPKtjef6bNOJ9aVPVCrVpt%2Fv59CHv3E4zLPVam2pr2%2FFc%2F789MlSmcZXVqIOgWcbElBEqDusWx9%2FcGroLPi%2F2NzMWgOBufeGh7%2F%2BTq83MwqFQlQqlSUMw5yPYv8GPeOKVl1ZAewAAAAASUVORK5CYII%3D" rel="shortcut icon">
<script>
function saveNotetoFile(theid) {
    var note = document.getElementById(theid).value;
    var ewsnum = "EWS" + theid.replace(/\D/g,'');
    var datapackage = new Array(ewsnum, note);
    sendAsyncMessage("SaveNote", datapackage);
}

function clearAll() {
    var array = new Array("paul", "");
    sendAsyncMessage("deleteNotes", array);
    location.reload();
}

function clearSizes(user) {
    //Sends empty string to 'clear' sizes
    var sizearray = new Array("paul", "");
    sendAsyncMessage("SaveSizes", sizearray);
    location.reload();
}
</script>
</head>
<body>
    <h1>Paul Heil</h1>
    <p>List of currently assigned jobs.</p>

    <div class="gridster">
        <ul></ul>
    </div>
    <div class="container"><button id="reload" title="Refresh widget data" class="rel_but">Update Page</button></div>
    <div class="container"><button id="delete" title="Delete ALL user widget notes and sizes" class="del_but">Delete Notes</button></div>
    <div class="container"><button id="clearSize" title="Reset widget dimensions and locations" class="cs_but">Reset Sizes</button></div>
    <script type="text/javascript" src="resource://CAEJobLog-at-tenneco-dot-com/data/js/jquery-2.1.3.min.js"></script>
    <script type="text/javascript" src="resource://CAEJobLog-at-tenneco-dot-com/data/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="resource://CAEJobLog-at-tenneco-dot-com/data/js/jquery.gridster.js" charset="utf-8"></script>

<script>
    $( ".rel_but" ).button({ icons: {primary:'ui-icon-arrowrefresh-1-w'} });
    $( ".del_but" ).button({ icons: {primary:'ui-icon-trash'},text:false });
    $( ".cs_but" ).button({ icons: {primary:'ui-icon-transferthick-e-w'} });
</script>
    <script type="text/javascript" id="code">
    var gridster;

    $(function(){

      gridster = $(".gridster > ul").gridster({
          widget_margins: [10, 10],
          widget_base_dimensions: [100, 55],
          helper: 'clone',
          resize: {
            enabled: true,
            stop: function(e, ui, $widget) {
                var s = gridster.serialize();
                var s2 = JSON.stringify(s);
                //Save sizes
                var sizearray = new Array("paul", s2);
                sendAsyncMessage("SaveSizes", sizearray);
            }
          }
      }).data('gridster');
      
        $('.gridster').on('click', function() {
            var s = gridster.serialize();
            var s2 = JSON.stringify(s);
            try {
                //Save sizes
                var sizearray = new Array("paul", s2);
                sendAsyncMessage("SaveSizes", sizearray);
            } catch (e) {
                console.error(e + " Error");
            }
        });
    });
    </script>
    <script>
    function init() {
        addMessageListener("SetNote", function(msg) {
            var notearray = msg.data;
            var ews = notearray[1];
            var message = notearray[0];
            var note = document.getElementById(ews + '_note');
            note.value = message;
        }); 

        var thewidgets = clonedContentScriptObject.thewidgets;
        var serArray = clonedContentScriptObject.theserial;
        //Check if assigned job qty has changed 
        //First check if it's ever been set
        if (serArray !== "") {
            serArray = JSON.parse(serArray);
            //Then check if the length has changed
            if (thewidgets.length != serArray.length) {
                //Qty changed so clear widget location data
                clearSizes("_p");
            }
            //Qty not changed
            else {
                for (var h=0; h < thewidgets.length; h++) {
                    if (serArray) {
                        var c = serArray[h].col;
                        var r = serArray[h].row;
                        var x = serArray[h].size_x;
                        var y = serArray[h].size_y;
                        gridster.add_widget('<li class="new"><a href=http://pafoap01:8888/pls/prod/ece_ewo_web.ece_ewo_page?in_ewr_no=' + thewidgets[h] + '>' + thewidgets[h] + '</a><BR><textarea id="' + thewidgets[h] + '_note" placeholder="Notes:" autocomplete="off" spellcheck="true" rows="6" cols="23" onload="getNote(this.id)" oninput="saveNotetoFile(this.id);"></textarea></li>', x, y, c, r);
                        //Request note and add
                        sendAsyncMessage("GetNote", thewidgets[h]);
                    }
                    else {
                        gridster.add_widget('<li class="new"><a href=http://pafoap01:8888/pls/prod/ece_ewo_web.ece_ewo_page?in_ewr_no=' + thewidgets[h] + '>' + thewidgets[h] + '</a><BR><textarea id="' + thewidgets[h] + '_note" placeholder="Notes:" autocomplete="off" spellcheck="true" rows="6" cols="23" onload="getNote(this.id)" oninput="saveNotetoFile(this.id);"></textarea></li>', 2, 2);
                        //Request note and add
                        sendAsyncMessage("GetNote", thewidgets[h]);
                    }
                }
            }
        }
        //Not set so just add widgets
        else {
            for (var i=0; i < thewidgets.length; i++) {
                gridster.add_widget('<li class="new"><a href=http://pafoap01:8888/pls/prod/ece_ewo_web.ece_ewo_page?in_ewr_no=' + thewidgets[i] + '>' + thewidgets[i] + '</a><BR><textarea id="' + thewidgets[i] + '_note" placeholder="Notes:" autocomplete="off" spellcheck="true" rows="6" cols="23" onload="getNote(this.id)" oninput="saveNotetoFile(this.id);"></textarea></li>', 2, 2);
                //Request note and add
                sendAsyncMessage("GetNote", thewidgets[i]);
            } 
        }
    }
    //Reload when button pressed
    var works = document.getElementById("reload");
    works.addEventListener("click", function() {
        gridster.remove_all_widgets();
        init();
        location.reload();
    }, false);

    //Delete when button pressed
    var clearSS = document.getElementById("delete");
    clearSS.addEventListener("click", function() {
        clearAll();
    }, false);
    
    //Reset sizes when button pressed
    var clearSize = document.getElementById("clearSize");
    clearSize.addEventListener("click", function() {
        clearSizes("_p");
    }, false);
    
    $(window).load(function() {
        window.setTimeout(init, 100);
    });
    </script>
</body>
</html>