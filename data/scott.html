<!doctype html>
<html>
<head>
  <title>Job Log &raquo; SCOTT</title>
  <link rel="stylesheet" type="text/css" href="resource://CAEJobLog-at-tenneco-dot-com/data/css/jquery.gridster.css">
  <link rel="stylesheet" type="text/css" href="resource://CAEJobLog-at-tenneco-dot-com/data/css/user.css">
  <link rel="stylesheet" type="text/css" href="resource://CAEJobLog-at-tenneco-dot-com/data/css/jquery-ui.css">
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <link width="16px" height="16px" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8%2F9hAAAAB3RJTUUH3wQdDyMqFgHUUgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAARnQU1BAACxjwv8YQUAAAO9SURBVHjaZVNtSFtnFH5vbm7uvUk0Md%2FR3JmY1G4q2lTX4QrSYrf5sclG2GCMwXBjDH90PzpoCd3mz%2FWDdcMy9mcUNqqoSOucMtoMRYefrCZ%2BJMY0rppojEmu5t6Ye5ObmzsjdLTbgffAeTnnOc85PAcC%2FzGO4yTTM%2B72kV%2F9n%2BV4LZQgMd2UW7C2n5f5vnZWv6fTSZ88mw89Gywt%2Bd8eH1%2FseOiizyk0NuFuAK04bcPjJjWyTyhEUase3nK0lfaUE0Wz%2FwPweoONTufPP%2FrXdeWorkbc0q73IEoMqq4oXjxJoFMmnWS2b4L6YmmNtF9yaK%2B%2BdEI5XqgTF1wikdQMDDx4E8N0aNXp2njOqOIr64xzH5wvdqIIxBZySEao%2BC2vcqBqjPr0p%2B3BSPSwyaiXeUWJxIFpaMh1dX5%2B4%2FXRPxWVQzHUymkUcOd20cWxTdD9lOEmC848MAADZ5LisMnIzHpTjmMG16%2Ff%2FSUQ2CtjGAn%2BSn1pdK8Uk%2FIqFQz0EPxOCly%2Bv0eBBmRjYjiTeheo5OB3AIiOUvljTzht9wb228QkmUYYJodNT4vKWh2YT6zBD5chyQv6IpCXSgHvzEu7Ptp80rqz5i%2B7vJ9iw6EIn0%2Fz%2BgjP5u%2FFX%2B4W4zhyQJJstdlSfFhuQjfMJhSYlCAtkYEMJDmiPjepH%2B65rfO73WqGYY7H4XkesCxb1Nn1JS02GkuiZnMySqcgafKAVUtLOHoul7NuK2CMFtIi9PYtkHK5AI7juQsfd%2FHG%2BrNoqYAl12em8pUWw7aoqal2mGV5ZGx0i0jEDtQeL1VrFx0GyBgQKcMxoA0FuUJXBEFyZ22We%2Fe1r%2BVCWPPfkspPIhea37gC37x5LbO3F61OJGKERi2jR%2F6Sm08SgKrCcXKZU6gbohO%2Bx%2BtrukwmIw76fTarz3WQ3vEZ5VmGaahRfnUspN7esZ7JyVV7Ip41jM6YrGlLJehsVXlQrVZoLBtZ%2BOH7ax%2F65rdRKklBgiAc70GhUDI0TV2CC8GNG98crqwE60tUWNxioLN2nSTK0RJxS724Ny3C9Rz%2BlhIzviq1VVTlQB4CSTIEsyyDHIGd%2BlfKweDWub6%2BhxcHB5cbPZ6soaW1ZkdZQlAZHsYQrJgbcKVPOJqElTP2iPvWt1ead3d3jTAM5547pkwmK1tYWO3o7f3jczrFomtrdAVNLWIaDczV1b1IEoSBCodD8v7%2BflMsFoMJglh9DuCp7e7GzY8e%2BdoWF32n7tz57v1g0Ccv%2FEsLyjrSgEwmE45exGazdf8Df1CuBXbMTfEAAAAASUVORK5CYII%3D" rel="shortcut icon">
<script>
function saveNotetoFile(theid) {
    var note = document.getElementById(theid).value;
    var ewsnum = "EWS" + theid.replace(/\D/g,'');
    var datapackage = new Array(ewsnum, note);
    sendAsyncMessage("SaveNote", datapackage);
}

function clearAllSS() {
    var array = new Array("scott", "");
    sendAsyncMessage("deleteNotes", array);
    console.log("Stored EWS notes cleared.");
    location.reload();
}

function clearSizes(user) {
    //Sends empty string to 'clear' sizes
    var sizearray = new Array("scott", "");
    sendAsyncMessage("SaveSizes", sizearray);
    location.reload();
}
</script>
</head>
<body>
    <h1>Scott Braddock</h1>
    <p>List of currently assigned jobs.</p>

    <div class="gridster">
        <ul></ul>
    </div>
    <div class="container"><button id="reload" title="Refresh widget data" class="rel_but">Update Page</button></div>
    <div class="container"><button id="delete" title="Delete ALL user widget notes and sizes" class="del_but">Delete Notes</button></div>
    <div class="container"><button id="clearSize" title="Reset widget dimensions and locations" class="cs_but">Reset Sizes</button></div>
    <script type="text/javascript" src="resource://CAEJobLog-at-tenneco-dot-com/data/js/jquery-3.0.0.pre.js"></script>
    <script type="text/javascript" src="resource://CAEJobLog-at-tenneco-dot-com/data/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="resource://CAEJobLog-at-tenneco-dot-com/data/js/jquery.gridster.js" charset="utf-8"></script>

<script>
    $( ".rel_but" ).button({ icons: {primary:'ui-icon-arrowrefresh-1-w'} });
    $( ".del_but" ).button({ icons: {primary:'ui-icon-trash'},text:false });
    $( ".cs_but" ).button({ icons: {primary:'ui-icon-transferthick-e-w'} });
</script>
    <script type="text/javascript" id="code">
    var gridster;

    $(function(){

      gridster = $(".gridster > ul").gridster({
          widget_margins: [10, 10],
          widget_base_dimensions: [100, 55],
          helper: 'clone',
          resize: {
            enabled: true,
            stop: function(e, ui, $widget) {
                var s = gridster.serialize();
                var s2 = JSON.stringify(s);
                //Save sizes
                var sizearray = new Array("scott", s2);
                sendAsyncMessage("SaveSizes", sizearray);
            }
          }
      }).data('gridster');
      
        $('.gridster').on('click', function() {
            var s = gridster.serialize();
            var s2 = JSON.stringify(s);
            try {
                //Save sizes
                var sizearray = new Array("scott", s2);
                sendAsyncMessage("SaveSizes", sizearray);
            } catch (e) {
                console.error(e + " Error");
            }
        });
    });
    </script>
    <script>
    function init() {
        addMessageListener("SetNote", function(msg) {
            var notearray = msg.data;
            var ews = notearray[1];
            var message = notearray[0];
            var note = document.getElementById(ews + '_note');
            note.value = message;
        }); 
        
        var thewidgets = clonedContentScriptObject.thewidgets;
        var serArray = clonedContentScriptObject.theserial;
        //Check if assigned job qty has changed 
        //First check if it's ever been set
        if (serArray !== "") {
            var serArray = JSON.parse(serArray);
            //Then check if the length has changed
            if (thewidgets.length != serArray.length) {
                //Qty changed so clear widget location data
                clearSizes("_s");
            }
            //Qty not changed
            else {
                for (var h=0; h < thewidgets.length; h++) {
                    if (serArray) {
                        var c = serArray[h].col;
                        var r = serArray[h].row;
                        var x = serArray[h].size_x;
                        var y = serArray[h].size_y;           
                        gridster.add_widget('<li class="new"><a href=http://pafoap01:8888/pls/prod/ece_ewo_web.ece_ewo_page?in_ewr_no=' + thewidgets[h] + '>' + thewidgets[h] + '</a><BR><textarea id="' + thewidgets[h] + '_note" placeholder="Notes:" autocomplete="off" spellcheck="true" rows="6" cols="23" onload="getNote(this.id)" oninput="saveNotetoFile(this.id);"></textarea></li>', x, y, c, r);
                        //Request note and add
                        sendAsyncMessage("GetNote", thewidgets[h]);
                    }
                    else {
                        gridster.add_widget('<li class="new"><a href=http://pafoap01:8888/pls/prod/ece_ewo_web.ece_ewo_page?in_ewr_no=' + thewidgets[h] + '>' + thewidgets[h] + '</a><BR><textarea id="' + thewidgets[h] + '_note" placeholder="Notes:" autocomplete="off" spellcheck="true" rows="6" cols="23" onload="getNote(this.id)" oninput="saveNotetoFile(this.id);"></textarea></li>', 2, 2);
                        //Request note and add
                        sendAsyncMessage("GetNote", thewidgets[h]);
                    }
                }
            }
        }
        //Not set so just add widgets
        else {
            for (var h=0; h < thewidgets.length; h++) {
                gridster.add_widget('<li class="new"><a href=http://pafoap01:8888/pls/prod/ece_ewo_web.ece_ewo_page?in_ewr_no=' + thewidgets[h] + '>' + thewidgets[h] + '</a><BR><textarea id="' + thewidgets[h] + '_note" placeholder="Notes:" autocomplete="off" spellcheck="true" rows="6" cols="23" onload="getNote(this.id)" oninput="saveNotetoFile(this.id);"></textarea></li>', 2, 2);
                //Request note and add
                sendAsyncMessage("GetNote", thewidgets[h]);
            } 
        }
        //Reload when button pressed
        var works = document.getElementById("reload");
        works.addEventListener("click", function() {
            gridster.remove_all_widgets();
            init();
            location.reload();
      }, false);
    }
    
        //Delete when button pressed
        var clearSS = document.getElementById("delete");
        clearSS.addEventListener("click", function() {
            clearAllSS();
        }, false);
        
        //Reset sizes when button pressed
        var clearSize = document.getElementById("clearSize");
        clearSize.addEventListener("click", function() {
            clearSizes("_s");
        }, false);
    
    $(window).load(function() {
        window.setTimeout(init, 100);
    });
    </script>
</body>
</html>